!function(t){var e={};function r(n){if(e[n])return e[n].exports;var c=e[n]={i:n,l:!1,exports:{}};return t[n].call(c.exports,c,c.exports,r),c.l=!0,c.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var c in t)r.d(n,c,function(e){return t[e]}.bind(null,c));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);r(1),r(2),r(3),r(4);new Vue({el:"#app",data:{userSearch:""},methods:{getJson(t){return fetch(t).then(t=>t.json()).catch(t=>{this.$refs.error.text=t})},postJson(t,e){return fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(t=>t.json()).catch(t=>{this.$refs.error.text=t})},putJson(t,e){return fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(t=>t.json()).catch(t=>{this.$refs.error.text=t})},deleteJson(t){return fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json"}}).then(t=>t.json()).catch(t=>{this.$refs.error.setError(t)})}}})},function(t,e){Vue.component("products",{data:()=>({filtered:[],products:[]}),mounted(){this.$parent.getJson("/api/products").then(t=>{for(let e of t)this.$data.products.push(e),this.$data.filtered.push(e)})},methods:{filter(t){let e=new RegExp(t,"i");this.filtered=this.products.filter(t=>e.test(t.product_name))}},template:'<div class="products_catalog">\n                <product v-for="item of filtered" \n                :key="item.product_id" \n                :product="item" \n                @add-product="$parent.$refs.cart.addProduct"></product>\n            </div>'}),Vue.component("product",{props:["product"],template:'\n                <div class="product_item">\n                    <a :href="product.product_path" class="product_item_links">\n                        <img :src="product.product_img" alt="picture" class="guitar_imgSmall">\n                        <span class="product_item_name">{{ product.product_name }}</span>\n                    </a>\n                    <span class="product_item_price">{{ product.product_price }} RUB</span>\n                    <button class="product_item_btn" @click="$emit(\'add-product\', product)">Купить товар</button>\n                </div>'})},function(t,e){Vue.component("cart",{data:()=>({cartItems:[],showCart:!1}),mounted(){this.$parent.getJson("/api/cart").then(t=>{for(let e of t.contents)this.$data.cartItems.push(e)})},methods:{addProduct(t){let e=this.cartItems.find(e=>e.product_id===t.product_id);if(e)this.$parent.putJson("/api/cart/"+e.product_id,{quantity:1}).then(t=>{1===t.result&&e.quantity++});else{const e=Object.assign({quantity:1},t);this.$parent.postJson("/api/cart",e).then(t=>{1===t.result&&this.cartItems.push(e)})}},remove(t){t.quantity>1?this.$parent.putJson("/api/cart/"+t.product_id,{quantity:-1}).then(e=>{1===e.result&&t.quantity--}):this.$parent.deleteJson("/api/cart/"+t.product_id).then(e=>{1===e.result&&this.cartItems.splice(this.cartItems.indexOf(t),1)})}},template:'\n            <div>\n                <button class="btn-cart" type="button" @click="showCart = !showCart">Корзина</button>\n                <div class="cart-block" v-show="showCart">\n                    <cart-item v-for="item of cartItems" :key="item.product_id" :cart-item="item" @remove="remove"></cart-item>\n                    <p class="cart-block-empty" v-if="!cartItems.length">Товары не добавлены</p>\n                </div>\n            </div>'}),Vue.component("cart-item",{props:["cartItem"],template:'\n    <div class="cart-item">\n                    <img class="product-img" :src="cartItem.product_img" alt="picture" width="170" height="65">\n                    <div class="right-block">\n                        <div class="product-price">{{ cartItem.quantity*cartItem.product_price }} RUB</div>\n                        <button class="del-btn" @click="$emit(\'remove\', cartItem)">&times;</button>\n                    </div>\n                    <div class="product-desc">\n                        <div class="product-title">{{ cartItem.product_name }}</div>\n                        <div class="product-quantity">Quantity: {{ cartItem.quantity }}</div>\n                        <div class="product-single-price">RUB {{ cartItem.product_price }} each</div>\n                    </div>\n                </div>\n    '})},function(t,e){Vue.component("filter-el",{data:()=>({userSearch:""}),template:'<form action="#" class="search-form" @submit.prevent="$parent.$refs.products_catalog.filter(userSearch)">\n                <input type="text" class="search-field" v-model="userSearch">\n                <button type="submit" class="btn-search">\n                    <i class="fas fa-search"></i>\n                </button>\n            </form>'})},function(t,e){Vue.component("error",{data:()=>({text:""}),computed:{isVisible(){return""!==this.text}},template:'\n    <div class="error-block" v-if="isVisible">\n        <p class="error-msg">\n        <button class="close-btn" @click="text=\'\'">&times;</button>\n        {{ text }}\n</p>\n</div>\n    '})}]);